<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tournament Setup</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #121212;
      color: #ffffff;
      text-align: center;
      padding: 20px;
    }
    h1 {
      margin-bottom: 20px;
    }
    .section {
      background: #1e1e1e;
      border-radius: 8px;
      padding: 20px;
      margin: 20px auto;
      max-width: 500px;
    }
    label {
      display: block;
      margin: 10px 0 5px;
      font-weight: bold;
    }
    input[type="text"], textarea {
      width: 100%;
      padding: 8px;
      margin-bottom: 15px;
      background: #2a2a2a;
      border: 1px solid #444;
      color: #fff;
      border-radius: 4px;
    }
    .btn {
      background: #1e1e1e;
      border: 1px solid #444;
      padding: 10px 20px;
      color: #fff;
      cursor: pointer;
      border-radius: 4px;
      margin-top: 10px;
    }
    .btn:hover {
      background: #333;
    }
  </style>
</head>
<body>
  <h1>Cricket Tournament Setup</h1>

  <div class="section">
    <h2>Team 1</h2>
    <label for="team1Name">Team Name</label>
    <input type="text" id="team1Name" placeholder="Enter Team 1 Name">
    <label for="team1Players">Players (comma separated)</label>
    <textarea id="team1Players" rows="3" placeholder="Player1, Player2, ..."></textarea>
  </div>

  <div class="section">
    <h2>Team 2</h2>
    <label for="team2Name">Team Name</label>
    <input type="text" id="team2Name" placeholder="Enter Team 2 Name">
    <label for="team2Players">Players (comma separated)</label>
    <textarea id="team2Players" rows="3" placeholder="Player1, Player2, ..."></textarea>
  </div>

  <div class="section">
    <h2>Toss</h2>
    <label for="tossWinner">Toss Winner (team1 or team2)</label>
    <input type="text" id="tossWinner" placeholder="team1 or team2">
    <label for="tossDecision">Toss Decision (bat or bowl)</label>
    <input type="text" id="tossDecision" placeholder="bat or bowl">
  </div>

  <button class="btn" onclick="saveLocalTournament()">Save Locally</button>
  <button class="btn" onclick="saveTournamentToSupabase()">Save to Supabase</button>

  <!-- supabase client (v2) via CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    // replace with values from your Supabase project Settings â†’ API
    const SUPABASE_URL = "https://ukziqsqffdavuctzyngn.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVremlxc3FmZmRhdnVjdHp5bmduIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwMzA4MDQsImV4cCI6MjA3MzYwNjgwNH0.d8c2lnVKhoVLHHI3pKBLr9kaE1zB-ll5CjvFE8bZxQs";

    const { createClient } = supabase;
    const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    function saveLocalTournament() {
      const t = {
        team1: {
          name: document.getElementById('team1Name').value.trim(),
          players: document.getElementById('team1Players').value.split(',').map(p => p.trim())
        },
        team2: {
          name: document.getElementById('team2Name').value.trim(),
          players: document.getElementById('team2Players').value.split(',').map(p => p.trim())
        },
        toss: {
          winner: document.getElementById('tossWinner').value.trim(),
          decision: document.getElementById('tossDecision').value.trim()
        }
      };
      localStorage.setItem('tournamentData', JSON.stringify(t));
      alert('Tournament data saved locally!');
    }

    async function saveTournamentToSupabase() {
      const t = JSON.parse(localStorage.getItem("tournamentData") || "{}");
      if (!t || !t.team1 || !t.team2) {
        alert("No local tournamentData. Save locally first.");
        return;
      }

      // create team1
      const { data: team1Data, error: e1 } = await supabaseClient
        .from('teams').insert({ name: t.team1.name }).select().single();
      if (e1) return console.error('Team1 Error:', e1);

      // create players for team1
      const team1Players = t.team1.players
        .filter(p => p && p.trim())
        .map(p => ({ team_id: team1Data.id, name: p.trim() }));
      if (team1Players.length) {
        await supabaseClient.from('players').insert(team1Players);
      }

      // team2
      const { data: team2Data, error: e2 } = await supabaseClient
        .from('teams').insert({ name: t.team2.name }).select().single();
      if (e2) return console.error('Team2 Error:', e2);

      const team2Players = t.team2.players
        .filter(p => p && p.trim())
        .map(p => ({ team_id: team2Data.id, name: p.trim() }));
      if (team2Players.length) {
        await supabaseClient.from('players').insert(team2Players);
      }

      // toss winner normalization
      const tossWinnerRaw = (t.toss && t.toss.winner) || t.tossWinner || null;
      let tossWinner = tossWinnerRaw;
      if (tossWinnerRaw === "team1") tossWinner = "team1";
      else if (tossWinnerRaw === "team2") tossWinner = "team2";

      // create match
      const { data: matchRow, error: mErr } = await supabaseClient
        .from('matches')
        .insert({
          team1_id: team1Data.id,
          team2_id: team2Data.id,
          toss_winner: tossWinner,
          toss_decision: (t.toss && t.toss.decision) || t.decision || null
        }).select().single();

      if (mErr) return console.error('Match Error:', mErr);

      localStorage.setItem('matchId', String(matchRow.id));
      alert('Saved to Supabase (matchId=' + matchRow.id + ')');
    }
  </script>
</body>
</html>
